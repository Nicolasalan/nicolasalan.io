{
  "title": "Vision Transformer (ViT) - Patches",
  "summary": "Dividir os dados em patches e criar a classe, posição e incorporação de patches",
  "publishedAt": "2024-01-15",
  "tags": [
    "Pytorch",
    "ViT",
    "Transformer",
    "Vision"
  ],
  "shortTitle": "ViT",
  "body": {
    "raw": "\n## Equação 1: Dividir os dados em patches\n\n> Se puder dividir os dados de uma forma facil de enteder e boa de aprender, é provavel que o algoritmo tenha um maior desempenho com dados reais.\n\nPara começar primeiro precisa criar os embeddings de classe, posição e patch, Assim começando por uma incorporação de pacth.\n\n<Alert type=\"attention\">\n  Incorporação se refere a transformar os dados em um vetor (geralmente) de uma forma que o algoritmo consiga entender mais fácil.\n</Alert>\n\nAnalisando o artigo:\n\n* *D* tamanho do embeddings de patch.\n* Imagem com dimensão *H* x *W x C*.\n  * (*H* x *W*) - (altura, largura).\n  * *C* - numero de canais (RGB = 3).\n* Tamanho *N×(P^2⋅C)* da sequência de patch 2D.\n  * *(P, P)* - resolução da imagem em cada patch.\n  * *N = HW / P^2* numero resultante de patches que também serve como entrada para o MSA.\n\n<Image rounded width={600} height={400} caption=\"Visualização da transformação de imagem em patch\" src=\"/blog/patchs/patch.png\" />\n\n### Calculando manualmente utilizando Python\n\nUm exemplo de como calcular o número de patches de uma imagem com altura 224, largura 224 e patch de tamanho 16.\n\n```python\nheight = 224 # Altura\nwidth = 224 # Largura\ncolor_channels = 3 # Numero de canais\npatch_size = 16 # Ramanho do patch\n\n# Calculando N *(numero de patches)\nnumber_of_patches = int((height * width) / patch_size**2)\nprint(f\"Number of patches (N) with image height (H={height}), width (W={width}) and patch size (P={patch_size}): {number_of_patches}\")\n```\n\n```\nNumber of patches (N) with image height (H=224), width (W=224) and patch size (P=16): 196\n```\n\nAgora que temos o número de patches, precisa calcular o tamanho de vetor de cada patch.\n\n* **INPUT:** Imagem com dimensão *H* x *W x C*.\n* **OUTPUT:** Sequência de patch 2D com tamanho *N×(P^2⋅C)*.\n\n```python\n# input imagem shape\nembedding_layer_input_shape = (height, width, color_channels)\n\n# Output shape\nembedding_layer_output_shape = (number_of_patches, patch_size**2 * color_channels)\n\nprint(f\"Input shape (single 2D image): {embedding_layer_input_shape}\")\nprint(f\"Output shape (single 2D image flattened into patches): {embedding_layer_output_shape}\")\n```\n```\nInput shape (single 2D image): (224, 224, 3)\nOutput shape (single 2D image flattened into patches): (196, 768)\n```\n\n<Alert type=\"attention\">\nTodos os códigos se complementam!!\n</Alert>\n\n## Transformando uma imagem real em um patch\n\nA parte principal de replicar um artigo é criar partes menores (camadas), se concentrando na entrada e saída.\n\n```python\n# View single image\nplt.imshow(image.permute(1, 2, 0)) # ajustando a ordem dos canais\nplt.title(class_names[label])\nplt.axis(False);\n```\n\nPara começar do básico, mostrando somente a parte superior antes de fragmentar a imagem por inteiro.\n\n```python\n# Altere o formato da imagem para ser compatível com matplotlib (color_channels, height, width) -> (height, width, color_channels)\nimage_permuted = image.permute(1, 2, 0)\n\n# Índice para traçar a linha superior de pixels corrigidos\npatch_size = 16\nplt.figure(figsize=(patch_size, patch_size))\nplt.imshow(image_permuted[:patch_size, :, :]);\n```\n\nAgora que temos a linha superior da imagem, precisa dividir em patches.\n\n```python\n# Configure hiperparâmetros e certifique-se de que img_size e patch_size sejam compatíveis\nimg_size = 224\npatch_size = 16\nnum_patches = img_size/patch_size\nassert img_size % patch_size == 0, \"Image size must be divisible by patch size\"\nprint(f\"Number of patches per row: {num_patches}\\nPatch size: {patch_size} pixels x {patch_size} pixels\")\n\nfig, axs = plt.subplots(nrows=1,\n                        ncols=img_size // patch_size,\n                        figsize=(num_patches, num_patches),\n                        sharex=True,\n                        sharey=True)\n\nfor i, patch in enumerate(range(0, img_size, patch_size)):\n    axs[i].imshow(image_permuted[:patch_size, patch:patch+patch_size, :]); \n    axs[i].set_xlabel(i+1)\n    axs[i].set_xticks([])\n    axs[i].set_yticks([])\n```\n\n```\nNumber of patches per row: 14.0\nPatch size: 16 pixels x 16 pixels\n```\n\nAgora que fizemos para a parte superior vamos fazer para a imagem inteira.\n\n```python\n# Configure hiperparâmetros e certifique-se de que img_size e patch_size sejam compatíveis\nimg_size = 224\npatch_size = 16\nnum_patches = img_size/patch_size\nassert img_size % patch_size == 0, \"Image size must be divisible by patch size\"\nprint(f\"Number of patches per row: {num_patches}\\\n        \\nNumber of patches per column: {num_patches}\\\n        \\nTotal patches: {num_patches*num_patches}\\\n        \\nPatch size: {patch_size} pixels x {patch_size} pixels\")\n\n# Crie uma série de subtramas\nfig, axs = plt.subplots(nrows=img_size // patch_size, # precisa que int não flutue\n                        ncols=img_size // patch_size,\n                        figsize=(num_patches, num_patches),\n                        sharex=True,\n                        sharey=True)\n\n# Loop pela altura e largura da imagem\nfor i, patch_height in enumerate(range(0, img_size, patch_size)): # iterar pela altura\n    for j, patch_width in enumerate(range(0, img_size, patch_size)):# iterar pela largura\n\n        # Plote o patch da imagem permutada (image_permuted -> (Altura, Largura, Canais de cores))\n        axs[i, j].imshow(image_permuted[patch_height:patch_height+patch_size, # iterar pela altura\n                                        patch_width:patch_width+patch_size, # iterar pela largura\n                                        :]) #obtém todos os canais de cores\n\n        # Configure as informações do rótulo, remova as marcas para maior clareza e defina os rótulos para fora\n        axs[i, j].set_ylabel(i+1,\n                             rotation=\"horizontal\",\n                             horizontalalignment=\"right\",\n                             verticalalignment=\"center\")\n        axs[i, j].set_xlabel(j+1)\n        axs[i, j].set_xticks([])\n        axs[i, j].set_yticks([])\n        axs[i, j].label_outer()\n\n# Defina um supertítulo\nfig.suptitle(f\"{class_names[label]} -> Patchified\", fontsize=16)\nplt.show()\n```\n\n```\nNumber of patches per row: 14.0        \nNumber of patches per column: 14.0        \nTotal patches: 196.0        \nPatch size: 16 pixels x 16 pixels\n```\n\n### Criando patches de imagem com `torch.nn.Conv2d()`\n\nEssa incorporação de patches é o mesmo que utilizar `torch.nn.Conv2d()`, uma alternativa seria a entrada como formado de \nmapas de características (*pesos/ativações*) como na CNN.\n\n<Alert type=\"attention\">\nOu seja, podemos simplesmente utilizar um `kernel_size` e um `stripe` para criar os patches, que seria o mesmo, \ndo que fazer os `patch_size`.\n</Alert>\n\nNo exemplo do código, utiliza uma imagem 2D e convertemos em uma sequência de 1D de fragmentos 2D achatados.\n\nNo Pytorch podemos utilizar:\n\n* `torch.nn.Conv2d()` para fragmentar a imagem em uma sequência de mapas de características.\n* `torch.nn.flatten()` para achatá-los em uma sequência de vetores.\n\nPassamos como parâmetros `kernel_size` e `stride` com o mesmo valor de `patch_size` para obter o mesmo resultado.\nPara cada kernel convolucional de tamanho (patch_size, patch_size), e o `stripe` tera `patch_size` píxeis de tamanho.\n\n* `patch_size` = 16 -> Tamanho do patch\n* `kernel_size` = (patch_size, patch_size) -> altura e largura do kernel\n* `stride` = (patch_size) -> Tamanho dos píxeis\n\n<Image rounded width={600} height={400} caption=\"nn.Conv2d\" src=\"/blog/patchs/conv.png\" />\n\nAlém disso, definimos `in_channels=3`, pois são 3 canais de cores e `out_channels=768`, esse valor é o *D* da equação 1.\nEsse valor significa que cada imagem terá um vetor de incorporação de tamanho 768, para ser aprendido.\n\n```python\nfrom torch import nn\n\npatch_size=16\n\nconv2d = nn.Conv2d(in_channels=3, \n                   out_channels=768, \n                   kernel_size=patch_size,\n                   stride=patch_size,\n                   padding=0) # padding=0 -> sem padding, ou seja nao adiciona pixels na borda\n```\nPassando a imagem pela camada `conv2d` e verificando a forma de saída.\n\n```python\nimage_out_of_conv = conv2d(image.unsqueeze(0)) \nprint(image_out_of_conv.shape)\n```\n```\ntorch.Size([1, 768, 14, 14])\n```\n\nIsso significa que:\n```\ntorch.Size([1, 768, 14, 14]) -> [batch_size, embedding_dim, feature_map_height, feature_map_width]\n```\n\nPara visualizar os mapas:\n```python\nimport random\nrandom_indexes = random.sample(range(0, 758), k=5)\nprint(f\"Showing random convolutional feature maps from indexes: {random_indexes}\")\n\nfig, axs = plt.subplots(nrows=1, ncols=5, figsize=(12, 12))\n\nfor i, idx in enumerate(random_indexes):\n    image_conv_feature_map = image_out_of_conv[:, idx, :, :] \n    axs[i].imshow(image_conv_feature_map.squeeze().detach().numpy())\n    axs[i].set(xticklabels=[], yticklabels=[], xticks=[], yticks=[]);\n```\n\n<Image rounded width={600} height={400} caption=\"Mapas de recursos\" src=\"/blog/patchs/maps.png\" />\n\nEssa visualização pode mudar com o tempo, conforme a rede aprende, pois são pesos. Essa representação é de acordo \ncom a imagem original, ou seja, cada mapa de características é uma representação da imagem original.\n\nEm forma de valores seria:\n  \n```python\nsingle_feature_map = image_out_of_conv[:, 0, :, :]\nsingle_feature_map, single_feature_map.requires_grad\n```\n\n<Image rounded width={600} height={400} caption=\"Saida em valores\" src=\"/blog/patchs/one.png\" />\n\n<details>\n\nSaida do código:\n\n```\n(tensor([[[ 0.4732,  0.3567,  0.3377,  0.3736,  0.3208,  0.3913,  0.3464,\n            0.3702,  0.2541,  0.3594,  0.1984,  0.3982,  0.3741,  0.1251],\n          [ 0.4178,  0.4771,  0.3374,  0.3353,  0.3159,  0.4008,  0.3448,\n            0.3345,  0.5850,  0.4115,  0.2969,  0.2751,  0.6150,  0.4188],\n          [ 0.3209,  0.3776,  0.4970,  0.4272,  0.3301,  0.4787,  0.2754,\n            0.3726,  0.3298,  0.4631,  0.3087,  0.4915,  0.4129,  0.4592],\n          [ 0.4540,  0.4930,  0.5570,  0.2660,  0.2150,  0.2044,  0.2766,\n            0.2076,  0.3278,  0.3727,  0.2637,  0.2493,  0.2782,  0.3664],\n          [ 0.4920,  0.5671,  0.3298,  0.2992,  0.1437,  0.1701,  0.1554,\n            0.1375,  0.1377,  0.3141,  0.2694,  0.2771,  0.2412,  0.3700],\n          [ 0.5783,  0.5790,  0.4229,  0.5032,  0.1216,  0.1000,  0.0356,\n            0.1258, -0.0023,  0.1640,  0.2809,  0.2418,  0.2606,  0.3787],\n          [ 0.5334,  0.5645,  0.4781,  0.3307,  0.2391,  0.0461,  0.0095,\n            0.0542,  0.1012,  0.1331,  0.2446,  0.2526,  0.3323,  0.4120],\n          [ 0.5724,  0.2840,  0.5188,  0.3934,  0.1328,  0.0776,  0.0235,\n            0.1366,  0.3149,  0.2200,  0.2793,  0.2351,  0.4722,  0.4785],\n          [ 0.4009,  0.4570,  0.4972,  0.5785,  0.2261,  0.1447, -0.0028,\n            0.2772,  0.2697,  0.4008,  0.3606,  0.3372,  0.4535,  0.4492],\n          [ 0.5678,  0.5870,  0.5824,  0.3438,  0.5113,  0.0757,  0.1772,\n            0.3677,  0.3572,  0.3742,  0.3820,  0.4868,  0.3781,  0.4694],\n          [ 0.5845,  0.5877,  0.5826,  0.3212,  0.5276,  0.4840,  0.4825,\n            0.5523,  0.5308,  0.5085,  0.5606,  0.5720,  0.4928,  0.5581],\n          [ 0.5853,  0.5849,  0.5793,  0.3410,  0.4428,  0.4044,  0.3275,\n            0.4958,  0.4366,  0.5750,  0.5494,  0.5868,  0.5557,  0.5069],\n          [ 0.5880,  0.5888,  0.5796,  0.3377,  0.2635,  0.2347,  0.3145,\n            0.3486,  0.5158,  0.5722,  0.5347,  0.5753,  0.5816,  0.4378],\n          [ 0.5692,  0.5843,  0.5721,  0.5081,  0.2694,  0.2032,  0.1589,\n            0.3464,  0.5349,  0.5768,  0.5739,  0.5764,  0.5394,  0.4482]]],\n        grad_fn=<SliceBackward0>),\n True)\n```\n</details>\n\nO `grad_fn` significa que o Pytorch esta rastreando os gradientes de mapa, ou seja, quando for treinado ele será atualizado.\n\n### Achatando a incorporação do patch com `torch.nn.Flatten()`\n\nA saída ainda tem como dimensão 2D, porem precisa de uma sequência de 1D, para isso utilizamos `torch.nn.Flatten()`.\n\nO que temos agora é o *(P^2*C) = (16^2*3) = 768*. E a saída desejada uma saída de 1D de patches de 2D achatados. Entao o que \\\nprecisa é o *N* números de patches:\n\n```\n(196, 768) -> (número de patches, dimensão de incorporação) ->   N×(P^2⋅C)\n```\n\nO Pytorch já possui um componente chamado `torch.nn.Flatten()`, que nivela a entrada em uma sequência de 1D.\n\n<Alert type=\"warning\">\nNão queremos o tensor inteiro, somente o `feature_map_height` e `feature_map_width` de `image_out_of_conv`.\n</Alert>\n\n```python\nflatten = nn.Flatten(start_dim=2,  # feature_map_height\n                      end_dim=3)   # feature_map_width\n```\n\n#### Resumo\n\n1. Insira uma única imagem e adicione a uma camada `conv2d` para transformar em mapas de recurso 2D (incorporação de patch).\n2. Passe por um `torch.nn.Flatten()` para transformar os mapas de recursos 2D em uma sequência de 1D.\n\n```python\nplt.imshow(image.permute(1, 2, 0))\nplt.title(class_names[label])\nplt.axis(False);\nprint(f\"Original image shape: {image.shape}\")\n\n# 1. Conv2d\nimage_out_of_conv = conv2d(image.unsqueeze(0)) \nprint(f\"Image feature map shape: {image_out_of_conv.shape}\")\n\n# 2. Flatten\nimage_out_of_conv_flattened = flatten(image_out_of_conv)\nprint(f\"Flattened image feature map shape: {image_out_of_conv_flattened.shape}\")\n```\n\nA única diferença é que agora temos (768, 196) e precisa ser (196, 768), o Pytorch já possui uma função para reorganizar o tensor, com o `torch.Tensor.permute()`.\n\n```python\nimage_out_of_conv_flattened_reshaped = image_out_of_conv_flattened.permute(0, 2, 1) # [batch_size, P^2•C, N] -> [batch_size, N, P^2•C]\n```\n\nPara visualização:\n  \n```python\nsingle_flattened_feature_map = image_out_of_conv_flattened_reshaped[:, :, 0] # index: (batch_size, number_of_patches, embedding_dimension)\n\nplt.figure(figsize=(22, 22))\nplt.imshow(single_flattened_feature_map.detach().numpy())\nplt.title(f\"Flattened feature map shape: {single_flattened_feature_map.shape}\")\nplt.axis(False);\n```\n\nA saída vai ser **extremamente pequena** para ver, mas é possível ver que é uma sequência de 1D. Isso acontece porque\nno artigo original, o Transformers foi projetado para texto e não para imagem. Por isso o ViT transforma uma imagem\nem uma sequência de 1D, igual um texto.\n\n<details>\n\nVisualização do mapa de recursos achatados:\n\n```python\nsingle_flattened_feature_map, single_flattened_feature_map.requires_grad, single_flattened_feature_map.shape\n```\n\n```\n(tensor([[ 0.4732,  0.3567,  0.3377,  0.3736,  0.3208,  0.3913,  0.3464,  0.3702,\n           0.2541,  0.3594,  0.1984,  0.3982,  0.3741,  0.1251,  0.4178,  0.4771,\n           0.3374,  0.3353,  0.3159,  0.4008,  0.3448,  0.3345,  0.5850,  0.4115,\n           0.2969,  0.2751,  0.6150,  0.4188,  0.3209,  0.3776,  0.4970,  0.4272,\n           0.3301,  0.4787,  0.2754,  0.3726,  0.3298,  0.4631,  0.3087,  0.4915,\n           0.4129,  0.4592,  0.4540,  0.4930,  0.5570,  0.2660,  0.2150,  0.2044,\n           0.2766,  0.2076,  0.3278,  0.3727,  0.2637,  0.2493,  0.2782,  0.3664,\n           0.4920,  0.5671,  0.3298,  0.2992,  0.1437,  0.1701,  0.1554,  0.1375,\n           0.1377,  0.3141,  0.2694,  0.2771,  0.2412,  0.3700,  0.5783,  0.5790,\n           0.4229,  0.5032,  0.1216,  0.1000,  0.0356,  0.1258, -0.0023,  0.1640,\n           0.2809,  0.2418,  0.2606,  0.3787,  0.5334,  0.5645,  0.4781,  0.3307,\n           0.2391,  0.0461,  0.0095,  0.0542,  0.1012,  0.1331,  0.2446,  0.2526,\n           0.3323,  0.4120,  0.5724,  0.2840,  0.5188,  0.3934,  0.1328,  0.0776,\n           0.0235,  0.1366,  0.3149,  0.2200,  0.2793,  0.2351,  0.4722,  0.4785,\n           0.4009,  0.4570,  0.4972,  0.5785,  0.2261,  0.1447, -0.0028,  0.2772,\n           0.2697,  0.4008,  0.3606,  0.3372,  0.4535,  0.4492,  0.5678,  0.5870,\n           0.5824,  0.3438,  0.5113,  0.0757,  0.1772,  0.3677,  0.3572,  0.3742,\n           0.3820,  0.4868,  0.3781,  0.4694,  0.5845,  0.5877,  0.5826,  0.3212,\n           0.5276,  0.4840,  0.4825,  0.5523,  0.5308,  0.5085,  0.5606,  0.5720,\n           0.4928,  0.5581,  0.5853,  0.5849,  0.5793,  0.3410,  0.4428,  0.4044,\n           0.3275,  0.4958,  0.4366,  0.5750,  0.5494,  0.5868,  0.5557,  0.5069,\n           0.5880,  0.5888,  0.5796,  0.3377,  0.2635,  0.2347,  0.3145,  0.3486,\n           0.5158,  0.5722,  0.5347,  0.5753,  0.5816,  0.4378,  0.5692,  0.5843,\n           0.5721,  0.5081,  0.2694,  0.2032,  0.1589,  0.3464,  0.5349,  0.5768,\n           0.5739,  0.5764,  0.5394,  0.4482]], grad_fn=<SelectBackward0>),\n True,\n torch.Size([1, 196]))\n```\n</details>\n\nToda essa parte no artigo é o `Projeção Linear de Patches Flattned`.\n\n## Transformando a camada de incorporação do patch ViT em um módulo PyTorch\n\nAgora precisa colocar tudo em um módulo em Pytorch, para ser mais rápido e fácil de utilizar.\n\n```python\n# Criacao da classe com nome PatchEmbedding e herda de nn.Module\nclass PatchEmbedding(nn.Module):\n    \"\"\"Imagem 2D -> sequncia 1D\n\n    Args:\n        in_channels (int): Numero de canais\n        patch_size (int): Tamanho do patch\n        embedding_dim (int): Tamanho do embedding. padrao 768\n    \"\"\"\n    def __init__(self,\n                 in_channels:int=3,\n                 patch_size:int=16,\n                 embedding_dim:int=768):\n        super().__init__()\n\n        # Criacao dos patches\n        self.patcher = nn.Conv2d(in_channels=in_channels,\n                                 out_channels=embedding_dim,\n                                 kernel_size=patch_size,\n                                 stride=patch_size,\n                                 padding=0)\n\n        # Redimensionar os patches\n        self.flatten = nn.Flatten(start_dim=2, # somente um vetor\n                                  end_dim=3)\n\n    def forward(self, x):\n        # Verificar se a imagem é divisivel pelo tamanho do patch\n        image_resolution = x.shape[-1]\n        assert image_resolution % patch_size == 0, f\"Input image size must be divisble by patch size, image shape: {image_resolution}, patch size: {patch_size}\"\n\n        x_patched = self.patcher(x)\n        x_flattened = self.flatten(x_patched)\n        # 6. Reorganizar a incorporação do patch para que o número de patches seja o primeiro\n        return x_flattened.permute(0, 2, 1) # [batch_size, P^2•C, N] -> [batch_size, N, P^2•C]\n```\n\nPara testar:\n\n```python\nset_seeds() # modulos de utilidades\n\npatchify = PatchEmbedding(in_channels=3,\n                          patch_size=16,\n                          embedding_dim=768)\n\nprint(f\"Input image shape: {image.unsqueeze(0).shape}\")\npatch_embedded_image = patchify(image.unsqueeze(0)) \nprint(f\"Output patch embedding shape: {patch_embedded_image.shape}\")\n```\n```\nInput image shape: torch.Size([1, 3, 224, 224])\nOutput patch embedding shape: torch.Size([1, 196, 768])\n```\n\nToda essa classe se resume a isso:\n\n<Image rounded width={600} height={400} caption=\"Mapas de recursos\" src=\"/blog/patchs/equation.png\" />\n\n## Criando a incorporação do token de classe\n\n<Image rounded width={600} height={400} caption=\"Token\" src=\"/blog/patchs/firsts.png\" />\n\nPara criar uma incorporação de token aos patches que possa ser aprendida, precisa criar em um formado,\n`embedding_dimension` chamado de (*D*) e adicionar a uma dimensão `number_of_patches` chamado de (*N*).\n\nUm pseudocódigo:\n\n```python\npatch_embedding = [image_patch_1, image_patch_2, image_patch_3...]\nclass_token = learnable_embedding\npatch_embedding_with_class_token = torch.cat((class_token, patch_embedding), dim=1)\n```\n\n<Alert type=\"attention\">\n  A concatenação acontece `torch.cat()`com dimensão `dim=1`.\n</Alert>\n\nPara criar uma incorporação de token aos patches que possa ser aprendida, precisa do `batch_size` e dimensão\ndos patches, depois cria um `torch.ones()` (tensor de 1) com o tamanho do `batch_size` e `embedding_dimension`, e depois passa\npara o `torch.nn.Parameter()` para poder ser aprendido.\n\n```python\n# Tamanho do batch size\nbatch_size = patch_embedded_image.shape[0]\n# tamanho do embedding\nembedding_dimension = patch_embedded_image.shape[-1]\n\n# Cria um tensor de 1 com o tamanho do batch_size e embedding_dimension\nclass_token = nn.Parameter(torch.ones(batch_size, 1, embedding_dimension), # [batch_size, number_of_tokens, embedding_dimension]\n                           requires_grad=True) # possa ser aprendido\n\n# Mostrar 10 token\nprint(class_token[:, :, :10])\n\nprint(f\"Class token shape: {class_token.shape} -> [batch_size, number_of_tokens, embedding_dimension]\")\n```\n\n```\ntensor([[[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]], grad_fn=<SliceBackward0>)\nClass token shape: torch.Size([1, 1, 768]) -> [batch_size, number_of_tokens, embedding_dimension]\n```\n\n<Alert type=\"attention\">\n  Aqui está criando com `torch.ones`, mas na realidade utiliza o `torch.randn()`, para gerar dados aleatórios,\n  e ir melhorando com o tempo.\n</Alert>\n\nAgora precisa juntar (concatenar) o `class_token` com os patches de imagens `patch_embedded_image`.\n\n```python\n# Adicionar o class_token ao patch_embedded_image\npatch_embedded_image_with_class_embedding = torch.cat((class_token, patch_embedded_image),\n                                                      dim=1) # concatenar na dimensao 1\n\n# Print the sequence of patch embeddings with the prepended class token embedding\nprint(patch_embedded_image_with_class_embedding)\nprint(f\"Sequence of patch embeddings with class token prepended shape: {patch_embedded_image_with_class_embedding.shape} -> [batch_size, number_of_patches, embedding_dimension]\")\n```\n\n```\ntensor([[[ 1.0000,  1.0000,  1.0000,  ...,  1.0000,  1.0000,  1.0000],\n         [-0.9145,  0.2454, -0.2292,  ...,  0.6768, -0.4515,  0.3496],\n         [-0.7427,  0.1955, -0.3570,  ...,  0.5823, -0.3458,  0.3261],\n         ...,\n         [-1.0072,  0.2795, -0.2804,  ...,  0.7624, -0.4584,  0.3581],\n         [-0.9839,  0.1652, -0.1576,  ...,  0.7489, -0.5478,  0.3486],\n         [-0.9260,  0.1383, -0.1157,  ...,  0.5847, -0.4717,  0.3112]]],\n       grad_fn=<CatBackward0>)\nSequence of patch embeddings with class token prepended shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n```\n\n<Image rounded width={600} height={400} caption=\"Token em primeiro\" src=\"/blog/patchs/token.png\" />\n\n## Criando a incorporação de posição\n\nAgora é necessário criar uma incorporação de posição aos patches, ou seja, criar uma ordem.\n\n<Math>{\"E_{pos}\"}</Math>\n\n<Image rounded width={600} height={400} caption=\"Posição\" src=\"/blog/patchs/posicao.png\" />\n\nA sequência que será gerada com a posição servira como entrada para o MSA.\n\n```python\n# Calcular o N (numeros de patches)\nnumber_of_patches = int((height * width) / patch_size**2)\n\n# Dimensao do embedding\nembedding_dimension = patch_embedded_image_with_class_embedding.shape[2]\n\n# Criarcao do tensor de posicao\nposition_embedding = nn.Parameter(torch.ones(1,\n                                             number_of_patches+1,\n                                             embedding_dimension),\n                                  requires_grad=True) # deixar que possa ser aprendido\n\n# Mostrar 10 posicoes\nprint(position_embedding[:, :10, :10])\nprint(f\"Position embeddding shape: {position_embedding.shape} -> [batch_size, number_of_patches, embedding_dimension]\")\n```\n\n```\ntensor([[[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]], grad_fn=<SliceBackward0>)\nPosition embeddding shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n```\n\n<Alert type=\"attention\">\n  É normal que todos os valores aumentem em 1, porque o embeddings de posição é criado com `torch.ones()`.\n</Alert>\n\n```python\n# Adicionar o position_embedding ao patch_embedded_image_with_class_embedding\npatch_and_position_embedding = patch_embedded_image_with_class_embedding + position_embedding\nprint(patch_and_position_embedding)\nprint(f\"Patch embeddings, class token prepended and positional embeddings added shape: {patch_and_position_embedding.shape} -> [batch_size, number_of_patches, embedding_dimension]\")\n```\n\n```\ntensor([[[ 2.0000,  2.0000,  2.0000,  ...,  2.0000,  2.0000,  2.0000],\n         [ 0.0855,  1.2454,  0.7708,  ...,  1.6768,  0.5485,  1.3496],\n         [ 0.2573,  1.1955,  0.6430,  ...,  1.5823,  0.6542,  1.3261],\n         ...,\n         [-0.0072,  1.2795,  0.7196,  ...,  1.7624,  0.5416,  1.3581],\n         [ 0.0161,  1.1652,  0.8424,  ...,  1.7489,  0.4522,  1.3486],\n         [ 0.0740,  1.1383,  0.8843,  ...,  1.5847,  0.5283,  1.3112]]],\n       grad_fn=<AddBackward0>)\nPatch embeddings, class token prepended and positional embeddings added shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n```\n\n### Um resumo sobre tudo\n\n```python\nset_seeds()\n\n# 1. Defina o tamanho do patch\npatch_size = 16\n\n# 2. Imprima a forma do tensor da imagem original e obtenha as dimensões da imagem\nprint(f\"Image tensor shape: {image.shape}\")\nheight, width = image.shape[1], image.shape[2]\n\n# 3. Obtenha o tensor de imagem e adicione a dimensão do lote\nx = image.unsqueeze(0)\nprint(f\"Input image with batch dimension shape: {x.shape}\")\n\n# 4. Crie uma camada de incorporação de patch\npatch_embedding_layer = PatchEmbedding(in_channels=3,\n                                       patch_size=patch_size,\n                                       embedding_dim=768)\n\n# 5. Passe a imagem pela camada de incorporação de patch\npatch_embedding = patch_embedding_layer(x)\nprint(f\"Patching embedding shape: {patch_embedding.shape}\")\n\n# 6. Crie incorporação de token de classe\nbatch_size = patch_embedding.shape[0]\nembedding_dimension = patch_embedding.shape[-1]\nclass_token = nn.Parameter(torch.ones(batch_size, 1, embedding_dimension),\n                           requires_grad=True) \nprint(f\"Class token embedding shape: {class_token.shape}\")\n\n# 7. Anexe a incorporação de token de classe à incorporação de patch\npatch_embedding_class_token = torch.cat((class_token, patch_embedding), dim=1)\nprint(f\"Patch embedding with class token shape: {patch_embedding_class_token.shape}\")\n\n# 8. Criar incorporação de posição\nnumber_of_patches = int((height * width) / patch_size**2)\nposition_embedding = nn.Parameter(torch.ones(1, number_of_patches+1, embedding_dimension),\n                                  requires_grad=True) \n\n# 9. Adicione incorporação de posição à incorporação de patch com token de classe\npatch_and_position_embedding = patch_embedding_class_token + position_embedding\nprint(f\"Patch and position embedding shape: {patch_and_position_embedding.shape}\")\n```\n\n",
    "code": "var Component=(()=>{var m=Object.create;var i=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),_=(a,e)=>{for(var s in e)i(a,s,{get:e[s],enumerable:!0})},o=(a,e,s,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let l of u(e))!k.call(a,l)&&l!==s&&i(a,l,{get:()=>e[l],enumerable:!(c=h(e,l))||c.enumerable});return a};var b=(a,e,s)=>(s=a!=null?m(N(a)):{},o(e||!a||!a.__esModule?i(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=>o(i({},\"__esModule\",{value:!0}),a);var p=g((q,r)=>{r.exports=_jsx_runtime});var x={};_(x,{default:()=>w,frontmatter:()=>z});var n=b(p()),z={title:\"Vision Transformer (ViT) - Patches\",publishedAt:\"2024-01-15\",summary:\"Dividir os dados em patches e criar a classe, posi\\xE7\\xE3o e incorpora\\xE7\\xE3o de patches\",tags:[\"Pytorch\",\"ViT\",\"Transformer\",\"Vision\"],shortTitle:\"ViT\"};function d(a){let e=Object.assign({h2:\"h2\",blockquote:\"blockquote\",p:\"p\",ul:\"ul\",li:\"li\",em:\"em\",h3:\"h3\",pre:\"pre\",code:\"code\",span:\"span\",strong:\"strong\",br:\"br\",h4:\"h4\",ol:\"ol\"},a.components),{Alert:s,Image:c,Math:l}=e;return s||t(\"Alert\",!0),c||t(\"Image\",!0),l||t(\"Math\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h2,{id:\"equa\\xE7\\xE3o-1-dividir-os-dados-em-patches\",children:\"Equa\\xE7\\xE3o 1: Dividir os dados em patches\"}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Se puder dividir os dados de uma forma facil de enteder e boa de aprender, \\xE9 provavel que o algoritmo tenha um maior desempenho com dados reais.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Para come\\xE7ar primeiro precisa criar os embeddings de classe, posi\\xE7\\xE3o e patch, Assim come\\xE7ando por uma incorpora\\xE7\\xE3o de pacth.\"}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsx)(e.p,{children:\"Incorpora\\xE7\\xE3o se refere a transformar os dados em um vetor (geralmente) de uma forma que o algoritmo consiga entender mais f\\xE1cil.\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Analisando o artigo:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.em,{children:\"D\"}),\" tamanho do embeddings de patch.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Imagem com dimens\\xE3o \",(0,n.jsx)(e.em,{children:\"H\"}),\" x \",(0,n.jsx)(e.em,{children:\"W x C\"}),\".\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"(\",(0,n.jsx)(e.em,{children:\"H\"}),\" x \",(0,n.jsx)(e.em,{children:\"W\"}),\") - (altura, largura).\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.em,{children:\"C\"}),\" - numero de canais (RGB = 3).\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Tamanho \",(0,n.jsx)(e.em,{children:\"N\\xD7(P^2\\u22C5C)\"}),\" da sequ\\xEAncia de patch 2D.\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.em,{children:\"(P, P)\"}),\" - resolu\\xE7\\xE3o da imagem em cada patch.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.em,{children:\"N = HW / P^2\"}),\" numero resultante de patches que tamb\\xE9m serve como entrada para o MSA.\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Visualiza\\xE7\\xE3o da transforma\\xE7\\xE3o de imagem em patch\",src:\"/blog/patchs/patch.png\"}),`\n`,(0,n.jsx)(e.h3,{id:\"calculando-manualmente-utilizando-python\",children:\"Calculando manualmente utilizando Python\"}),`\n`,(0,n.jsx)(e.p,{children:\"Um exemplo de como calcular o n\\xFAmero de patches de uma imagem com altura 224, largura 224 e patch de tamanho 16.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"height \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"224\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Altura\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"width \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"224\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Largura\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"color_channels \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Numero de canais\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Ramanho do patch\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Calculando N *(numero de patches)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"number_of_patches \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"height \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Number of patches (N) with image height (H='}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"height\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"), width (W=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\") and patch size (P=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"): \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"number_of_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`Number of patches (N) with image height (H=224), width (W=224) and patch size (P=16): 196\n`})})}),`\n`,(0,n.jsx)(e.p,{children:\"Agora que temos o n\\xFAmero de patches, precisa calcular o tamanho de vetor de cada patch.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"INPUT:\"}),\" Imagem com dimens\\xE3o \",(0,n.jsx)(e.em,{children:\"H\"}),\" x \",(0,n.jsx)(e.em,{children:\"W x C\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"OUTPUT:\"}),\" Sequ\\xEAncia de patch 2D com tamanho \",(0,n.jsx)(e.em,{children:\"N\\xD7(P^2\\u22C5C)\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# input imagem shape\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"embedding_layer_input_shape \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"height\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" color_channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Output shape\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"embedding_layer_output_shape \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"number_of_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" color_channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Input shape (single 2D image): '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"embedding_layer_input_shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Output shape (single 2D image flattened into patches): '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"embedding_layer_output_shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Input shape (single 2D image): (224, 224, 3)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Output shape (single 2D image flattened into patches): (196, 768)\n`})]})}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsx)(e.p,{children:\"Todos os c\\xF3digos se complementam!!\"})}),`\n`,(0,n.jsx)(e.h2,{id:\"transformando-uma-imagem-real-em-um-patch\",children:\"Transformando uma imagem real em um patch\"}),`\n`,(0,n.jsx)(e.p,{children:\"A parte principal de replicar um artigo \\xE9 criar partes menores (camadas), se concentrando na entrada e sa\\xEDda.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# View single image\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ajustando a ordem dos canais\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_names\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"axis\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Para come\\xE7ar do b\\xE1sico, mostrando somente a parte superior antes de fragmentar a imagem por inteiro.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Altere o formato da imagem para ser compat\\xEDvel com matplotlib (color_channels, height, width) -> (height, width, color_channels)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"image_permuted \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\xCDndice para tra\\xE7ar a linha superior de pixels corrigidos\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"figure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"figsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_permuted\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Agora que temos a linha superior da imagem, precisa dividir em patches.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Configure hiperpar\\xE2metros e certifique-se de que img_size e patch_size sejam compat\\xEDveis\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"224\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"num_patches \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" img_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),`patch_size\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Image size must be divisible by patch size\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Number of patches per row: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"\\\\nPatch size: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" pixels x \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' pixels\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" axs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"subplots\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nrows\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        ncols\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"//\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        figsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        sharex\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        sharey\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" img_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_permuted\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"patch\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_xlabel\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_xticks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_yticks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Number of patches per row: 14.0\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Patch size: 16 pixels x 16 pixels\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Agora que fizemos para a parte superior vamos fazer para a imagem inteira.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Configure hiperpar\\xE2metros e certifique-se de que img_size e patch_size sejam compat\\xEDveis\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"224\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"num_patches \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" img_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),`patch_size\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Image size must be divisible by patch size\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),'f\"Number of patches per row',(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\\\\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \\\\nNumber of patches per column\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\\\\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \\\\nTotal patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\\\\\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \\\\nPatch size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" pixels x \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),' pixels\"',(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Crie uma s\\xE9rie de subtramas\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" axs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"subplots\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nrows\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"//\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# precisa que int n\\xE3o flutue\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        ncols\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"img_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"//\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        figsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" num_patches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        sharex\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                        sharey\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Loop pela altura e largura da imagem\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_height \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" img_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# iterar pela altura\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_width \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" img_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token comment\",children:\"# iterar pela largura\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Plote o patch da imagem permutada (image_permuted -> (Altura, Largura, Canais de cores))\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_permuted\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"patch_height\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"patch_height\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# iterar pela altura\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        patch_width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"patch_width\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# iterar pela largura\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"#obt\\xE9m todos os canais de cores\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Configure as informa\\xE7\\xF5es do r\\xF3tulo, remova as marcas para maior clareza e defina os r\\xF3tulos para fora\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_ylabel\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                             rotation\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"horizontal\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                             horizontalalignment\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"right\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                             verticalalignment\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"center\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_xlabel\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"j\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_xticks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_yticks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" j\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"label_outer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Defina um supert\\xEDtulo\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"suptitle\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"class_names\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' -> Patchified\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fontsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"show\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Number of patches per row: 14.0        \n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Number of patches per column: 14.0        \n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Total patches: 196.0        \n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Patch size: 16 pixels x 16 pixels\n`})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"criando-patches-de-imagem-com-torchnnconv2d\",children:[\"Criando patches de imagem com \",(0,n.jsx)(e.code,{children:\"torch.nn.Conv2d()\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Essa incorpora\\xE7\\xE3o de patches \\xE9 o mesmo que utilizar \",(0,n.jsx)(e.code,{children:\"torch.nn.Conv2d()\"}),`, uma alternativa seria a entrada como formado de\nmapas de caracter\\xEDsticas (`,(0,n.jsx)(e.em,{children:\"pesos/ativa\\xE7\\xF5es\"}),\") como na CNN.\"]}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsxs)(e.p,{children:[\"Ou seja, podemos simplesmente utilizar um \",(0,n.jsx)(e.code,{children:\"kernel_size\"}),\" e um \",(0,n.jsx)(e.code,{children:\"stripe\"}),` para criar os patches, que seria o mesmo,\ndo que fazer os `,(0,n.jsx)(e.code,{children:\"patch_size\"}),\".\"]})}),`\n`,(0,n.jsx)(e.p,{children:\"No exemplo do c\\xF3digo, utiliza uma imagem 2D e convertemos em uma sequ\\xEAncia de 1D de fragmentos 2D achatados.\"}),`\n`,(0,n.jsx)(e.p,{children:\"No Pytorch podemos utilizar:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"torch.nn.Conv2d()\"}),\" para fragmentar a imagem em uma sequ\\xEAncia de mapas de caracter\\xEDsticas.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"torch.nn.flatten()\"}),\" para achat\\xE1-los em uma sequ\\xEAncia de vetores.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Passamos como par\\xE2metros \",(0,n.jsx)(e.code,{children:\"kernel_size\"}),\" e \",(0,n.jsx)(e.code,{children:\"stride\"}),\" com o mesmo valor de \",(0,n.jsx)(e.code,{children:\"patch_size\"}),` para obter o mesmo resultado.\nPara cada kernel convolucional de tamanho (patch_size, patch_size), e o `,(0,n.jsx)(e.code,{children:\"stripe\"}),\" tera \",(0,n.jsx)(e.code,{children:\"patch_size\"}),\" p\\xEDxeis de tamanho.\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"patch_size\"}),\" = 16 -> Tamanho do patch\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"kernel_size\"}),\" = (patch_size, patch_size) -> altura e largura do kernel\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"stride\"}),\" = (patch_size) -> Tamanho dos p\\xEDxeis\"]}),`\n`]}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"nn.Conv2d\",src:\"/blog/patchs/conv.png\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Al\\xE9m disso, definimos \",(0,n.jsx)(e.code,{children:\"in_channels=3\"}),\", pois s\\xE3o 3 canais de cores e \",(0,n.jsx)(e.code,{children:\"out_channels=768\"}),\", esse valor \\xE9 o \",(0,n.jsx)(e.em,{children:\"D\"}),` da equa\\xE7\\xE3o 1.\nEsse valor significa que cada imagem ter\\xE1 um vetor de incorpora\\xE7\\xE3o de tamanho 768, para ser aprendido.`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" torch \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` nn\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"conv2d \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Conv2d\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"in_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                   out_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"768\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                   kernel_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                   stride\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                   padding\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# padding=0 -> sem padding, ou seja nao adiciona pixels na borda\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Passando a imagem pela camada \",(0,n.jsx)(e.code,{children:\"conv2d\"}),\" e verificando a forma de sa\\xEDda.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"image_out_of_conv \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" conv2d\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"unsqueeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_out_of_conv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`torch.Size([1, 768, 14, 14])\n`})})}),`\n`,(0,n.jsx)(e.p,{children:\"Isso significa que:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`torch.Size([1, 768, 14, 14]) -> [batch_size, embedding_dim, feature_map_height, feature_map_width]\n`})})}),`\n`,(0,n.jsx)(e.p,{children:\"Para visualizar os mapas:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` random\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"random_indexes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" random\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sample\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"range\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"758\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" k\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Showing random convolutional feature maps from indexes: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"random_indexes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" axs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"subplots\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nrows\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ncols\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" figsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"12\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" idx \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"enumerate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"random_indexes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    image_conv_feature_map \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image_out_of_conv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" idx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_conv_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"squeeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"detach\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    axs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"set\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"xticklabels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" yticklabels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" xticks\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" yticks\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Mapas de recursos\",src:\"/blog/patchs/maps.png\"}),`\n`,(0,n.jsx)(e.p,{children:`Essa visualiza\\xE7\\xE3o pode mudar com o tempo, conforme a rede aprende, pois s\\xE3o pesos. Essa representa\\xE7\\xE3o \\xE9 de acordo\ncom a imagem original, ou seja, cada mapa de caracter\\xEDsticas \\xE9 uma representa\\xE7\\xE3o da imagem original.`}),`\n`,(0,n.jsx)(e.p,{children:\"Em forma de valores seria:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"single_feature_map \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image_out_of_conv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"single_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" single_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`requires_grad\n`]})]})}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Saida em valores\",src:\"/blog/patchs/one.png\"}),`\n`,(0,n.jsxs)(\"details\",{children:[(0,n.jsx)(e.p,{children:\"Saida do c\\xF3digo:\"}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`(tensor([[[ 0.4732,  0.3567,  0.3377,  0.3736,  0.3208,  0.3913,  0.3464,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3702,  0.2541,  0.3594,  0.1984,  0.3982,  0.3741,  0.1251],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.4178,  0.4771,  0.3374,  0.3353,  0.3159,  0.4008,  0.3448,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3345,  0.5850,  0.4115,  0.2969,  0.2751,  0.6150,  0.4188],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.3209,  0.3776,  0.4970,  0.4272,  0.3301,  0.4787,  0.2754,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3726,  0.3298,  0.4631,  0.3087,  0.4915,  0.4129,  0.4592],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.4540,  0.4930,  0.5570,  0.2660,  0.2150,  0.2044,  0.2766,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.2076,  0.3278,  0.3727,  0.2637,  0.2493,  0.2782,  0.3664],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.4920,  0.5671,  0.3298,  0.2992,  0.1437,  0.1701,  0.1554,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.1375,  0.1377,  0.3141,  0.2694,  0.2771,  0.2412,  0.3700],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5783,  0.5790,  0.4229,  0.5032,  0.1216,  0.1000,  0.0356,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.1258, -0.0023,  0.1640,  0.2809,  0.2418,  0.2606,  0.3787],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5334,  0.5645,  0.4781,  0.3307,  0.2391,  0.0461,  0.0095,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.0542,  0.1012,  0.1331,  0.2446,  0.2526,  0.3323,  0.4120],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5724,  0.2840,  0.5188,  0.3934,  0.1328,  0.0776,  0.0235,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.1366,  0.3149,  0.2200,  0.2793,  0.2351,  0.4722,  0.4785],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.4009,  0.4570,  0.4972,  0.5785,  0.2261,  0.1447, -0.0028,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.2772,  0.2697,  0.4008,  0.3606,  0.3372,  0.4535,  0.4492],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5678,  0.5870,  0.5824,  0.3438,  0.5113,  0.0757,  0.1772,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3677,  0.3572,  0.3742,  0.3820,  0.4868,  0.3781,  0.4694],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5845,  0.5877,  0.5826,  0.3212,  0.5276,  0.4840,  0.4825,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.5523,  0.5308,  0.5085,  0.5606,  0.5720,  0.4928,  0.5581],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5853,  0.5849,  0.5793,  0.3410,  0.4428,  0.4044,  0.3275,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.4958,  0.4366,  0.5750,  0.5494,  0.5868,  0.5557,  0.5069],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5880,  0.5888,  0.5796,  0.3377,  0.2635,  0.2347,  0.3145,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3486,  0.5158,  0.5722,  0.5347,  0.5753,  0.5816,  0.4378],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          [ 0.5692,  0.5843,  0.5721,  0.5081,  0.2694,  0.2032,  0.1589,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`            0.3464,  0.5349,  0.5768,  0.5739,  0.5764,  0.5394,  0.4482]]],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        grad_fn=<SliceBackward0>),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:` True)\n`})]})})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"O \",(0,n.jsx)(e.code,{children:\"grad_fn\"}),\" significa que o Pytorch esta rastreando os gradientes de mapa, ou seja, quando for treinado ele ser\\xE1 atualizado.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"achatando-a-incorpora\\xE7\\xE3o-do-patch-com-torchnnflatten\",children:[\"Achatando a incorpora\\xE7\\xE3o do patch com \",(0,n.jsx)(e.code,{children:\"torch.nn.Flatten()\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"A sa\\xEDda ainda tem como dimens\\xE3o 2D, porem precisa de uma sequ\\xEAncia de 1D, para isso utilizamos \",(0,n.jsx)(e.code,{children:\"torch.nn.Flatten()\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"O que temos agora \\xE9 o \",(0,n.jsx)(e.em,{children:\"(P^2\"}),\"C) = (16^2\",(0,n.jsx)(e.em,{children:\"3) = 768\"}),\". E a sa\\xEDda desejada uma sa\\xEDda de 1D de patches de 2D achatados. Entao o que \",(0,n.jsx)(e.br,{}),`\n`,\"precisa \\xE9 o \",(0,n.jsx)(e.em,{children:\"N\"}),\" n\\xFAmeros de patches:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`(196, 768) -> (n\\xFAmero de patches, dimens\\xE3o de incorpora\\xE7\\xE3o) ->   N\\xD7(P^2\\u22C5C)\n`})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"O Pytorch j\\xE1 possui um componente chamado \",(0,n.jsx)(e.code,{children:\"torch.nn.Flatten()\"}),\", que nivela a entrada em uma sequ\\xEAncia de 1D.\"]}),`\n`,(0,n.jsx)(s,{type:\"warning\",children:(0,n.jsxs)(e.p,{children:[\"N\\xE3o queremos o tensor inteiro, somente o \",(0,n.jsx)(e.code,{children:\"feature_map_height\"}),\" e \",(0,n.jsx)(e.code,{children:\"feature_map_width\"}),\" de \",(0,n.jsx)(e.code,{children:\"image_out_of_conv\"}),\".\"]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"flatten \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Flatten\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"start_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# feature_map_height\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                      end_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\"   \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# feature_map_width\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.h4,{id:\"resumo\",children:\"Resumo\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Insira uma \\xFAnica imagem e adicione a uma camada \",(0,n.jsx)(e.code,{children:\"conv2d\"}),\" para transformar em mapas de recurso 2D (incorpora\\xE7\\xE3o de patch).\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Passe por um \",(0,n.jsx)(e.code,{children:\"torch.nn.Flatten()\"}),\" para transformar os mapas de recursos 2D em uma sequ\\xEAncia de 1D.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_names\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"axis\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Original image shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 1. Conv2d\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"image_out_of_conv \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" conv2d\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"unsqueeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Image feature map shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image_out_of_conv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 2. Flatten\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"image_out_of_conv_flattened \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" flatten\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image_out_of_conv\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Flattened image feature map shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image_out_of_conv_flattened\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"A \\xFAnica diferen\\xE7a \\xE9 que agora temos (768, 196) e precisa ser (196, 768), o Pytorch j\\xE1 possui uma fun\\xE7\\xE3o para reorganizar o tensor, com o \",(0,n.jsx)(e.code,{children:\"torch.Tensor.permute()\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsx)(e.code,{className:\"language-python code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"image_out_of_conv_flattened_reshaped \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image_out_of_conv_flattened\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# [batch_size, P^2\\u2022C, N] -> [batch_size, N, P^2\\u2022C]\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Para visualiza\\xE7\\xE3o:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"single_flattened_feature_map \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image_out_of_conv_flattened_reshaped\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# index: (batch_size, number_of_patches, embedding_dimension)\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"figure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"figsize\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"22\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"22\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"imshow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"single_flattened_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"detach\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"numpy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Flattened feature map shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"single_flattened_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"plt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"axis\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"A sa\\xEDda vai ser \",(0,n.jsx)(e.strong,{children:\"extremamente pequena\"}),` para ver, mas \\xE9 poss\\xEDvel ver que \\xE9 uma sequ\\xEAncia de 1D. Isso acontece porque\nno artigo original, o Transformers foi projetado para texto e n\\xE3o para imagem. Por isso o ViT transforma uma imagem\nem uma sequ\\xEAncia de 1D, igual um texto.`]}),`\n`,(0,n.jsxs)(\"details\",{children:[(0,n.jsx)(e.p,{children:\"Visualiza\\xE7\\xE3o do mapa de recursos achatados:\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsx)(e.code,{className:\"language-python code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"single_flattened_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" single_flattened_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"requires_grad\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" single_flattened_feature_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`shape\n`]})})}),(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`(tensor([[ 0.4732,  0.3567,  0.3377,  0.3736,  0.3208,  0.3913,  0.3464,  0.3702,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2541,  0.3594,  0.1984,  0.3982,  0.3741,  0.1251,  0.4178,  0.4771,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.3374,  0.3353,  0.3159,  0.4008,  0.3448,  0.3345,  0.5850,  0.4115,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2969,  0.2751,  0.6150,  0.4188,  0.3209,  0.3776,  0.4970,  0.4272,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.3301,  0.4787,  0.2754,  0.3726,  0.3298,  0.4631,  0.3087,  0.4915,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.4129,  0.4592,  0.4540,  0.4930,  0.5570,  0.2660,  0.2150,  0.2044,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2766,  0.2076,  0.3278,  0.3727,  0.2637,  0.2493,  0.2782,  0.3664,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.4920,  0.5671,  0.3298,  0.2992,  0.1437,  0.1701,  0.1554,  0.1375,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.1377,  0.3141,  0.2694,  0.2771,  0.2412,  0.3700,  0.5783,  0.5790,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.4229,  0.5032,  0.1216,  0.1000,  0.0356,  0.1258, -0.0023,  0.1640,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2809,  0.2418,  0.2606,  0.3787,  0.5334,  0.5645,  0.4781,  0.3307,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2391,  0.0461,  0.0095,  0.0542,  0.1012,  0.1331,  0.2446,  0.2526,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.3323,  0.4120,  0.5724,  0.2840,  0.5188,  0.3934,  0.1328,  0.0776,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.0235,  0.1366,  0.3149,  0.2200,  0.2793,  0.2351,  0.4722,  0.4785,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.4009,  0.4570,  0.4972,  0.5785,  0.2261,  0.1447, -0.0028,  0.2772,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.2697,  0.4008,  0.3606,  0.3372,  0.4535,  0.4492,  0.5678,  0.5870,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5824,  0.3438,  0.5113,  0.0757,  0.1772,  0.3677,  0.3572,  0.3742,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.3820,  0.4868,  0.3781,  0.4694,  0.5845,  0.5877,  0.5826,  0.3212,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5276,  0.4840,  0.4825,  0.5523,  0.5308,  0.5085,  0.5606,  0.5720,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.4928,  0.5581,  0.5853,  0.5849,  0.5793,  0.3410,  0.4428,  0.4044,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.3275,  0.4958,  0.4366,  0.5750,  0.5494,  0.5868,  0.5557,  0.5069,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5880,  0.5888,  0.5796,  0.3377,  0.2635,  0.2347,  0.3145,  0.3486,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5158,  0.5722,  0.5347,  0.5753,  0.5816,  0.4378,  0.5692,  0.5843,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5721,  0.5081,  0.2694,  0.2032,  0.1589,  0.3464,  0.5349,  0.5768,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`           0.5739,  0.5764,  0.5394,  0.4482]], grad_fn=<SelectBackward0>),\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:` True,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:` torch.Size([1, 196]))\n`})]})})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Toda essa parte no artigo \\xE9 o \",(0,n.jsx)(e.code,{children:\"Proje\\xE7\\xE3o Linear de Patches Flattned\"}),\".\"]}),`\n`,(0,n.jsx)(e.h2,{id:\"transformando-a-camada-de-incorpora\\xE7\\xE3o-do-patch-vit-em-um-m\\xF3dulo-pytorch\",children:\"Transformando a camada de incorpora\\xE7\\xE3o do patch ViT em um m\\xF3dulo PyTorch\"}),`\n`,(0,n.jsx)(e.p,{children:\"Agora precisa colocar tudo em um m\\xF3dulo em Pytorch, para ser mais r\\xE1pido e f\\xE1cil de utilizar.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Criacao da classe com nome PatchEmbedding e herda de nn.Module\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PatchEmbedding\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Module\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`\"\"\"Imagem 2D -> sequncia 1D\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`    Args:\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`        in_channels (int): Numero de canais\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`        patch_size (int): Tamanho do patch\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:`        embedding_dim (int): Tamanho do embedding. padrao 768\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token triple-quoted-string string\",children:'    \"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"__init__\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                 in_channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                 patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                 embedding_dim\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"768\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"super\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"__init__\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Criacao dos patches\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"patcher \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Conv2d\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"in_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"in_channels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                 out_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"embedding_dim\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                 kernel_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                 stride\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                 padding\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Redimensionar os patches\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"flatten \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Flatten\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"start_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# somente um vetor\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                  end_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"forward\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Verificar se a imagem \\xE9 divisivel pelo tamanho do patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        image_resolution \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"assert\"}),\" image_resolution \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Input image size must be divisble by patch size, image shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image_resolution\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\", patch size: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        x_patched \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"patcher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        x_flattened \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"flatten\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"x_patched\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 6. Reorganizar a incorpora\\xE7\\xE3o do patch para que o n\\xFAmero de patches seja o primeiro\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" x_flattened\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"permute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# [batch_size, P^2\\u2022C, N] -> [batch_size, N, P^2\\u2022C]\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Para testar:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"set_seeds\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# modulos de utilidades\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patchify \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PatchEmbedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"in_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                          patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                          embedding_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"768\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Input image shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"unsqueeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedded_image \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patchify\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"unsqueeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Output patch embedding shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_embedded_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Input image shape: torch.Size([1, 3, 224, 224])\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Output patch embedding shape: torch.Size([1, 196, 768])\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Toda essa classe se resume a isso:\"}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Mapas de recursos\",src:\"/blog/patchs/equation.png\"}),`\n`,(0,n.jsx)(e.h2,{id:\"criando-a-incorpora\\xE7\\xE3o-do-token-de-classe\",children:\"Criando a incorpora\\xE7\\xE3o do token de classe\"}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Token\",src:\"/blog/patchs/firsts.png\"}),`\n`,(0,n.jsxs)(e.p,{children:[`Para criar uma incorpora\\xE7\\xE3o de token aos patches que possa ser aprendida, precisa criar em um formado,\n`,(0,n.jsx)(e.code,{children:\"embedding_dimension\"}),\" chamado de (\",(0,n.jsx)(e.em,{children:\"D\"}),\") e adicionar a uma dimens\\xE3o \",(0,n.jsx)(e.code,{children:\"number_of_patches\"}),\" chamado de (\",(0,n.jsx)(e.em,{children:\"N\"}),\").\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Um pseudoc\\xF3digo:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"image_patch_1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" image_patch_2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" image_patch_3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` learnable_embedding\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedding_with_class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"cat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsxs)(e.p,{children:[\"A concatena\\xE7\\xE3o acontece \",(0,n.jsx)(e.code,{children:\"torch.cat()\"}),\"com dimens\\xE3o \",(0,n.jsx)(e.code,{children:\"dim=1\"}),\".\"]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Para criar uma incorpora\\xE7\\xE3o de token aos patches que possa ser aprendida, precisa do \",(0,n.jsx)(e.code,{children:\"batch_size\"}),` e dimens\\xE3o\ndos patches, depois cria um `,(0,n.jsx)(e.code,{children:\"torch.ones()\"}),\" (tensor de 1) com o tamanho do \",(0,n.jsx)(e.code,{children:\"batch_size\"}),\" e \",(0,n.jsx)(e.code,{children:\"embedding_dimension\"}),`, e depois passa\npara o `,(0,n.jsx)(e.code,{children:\"torch.nn.Parameter()\"}),\" para poder ser aprendido.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Tamanho do batch size\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"batch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedded_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# tamanho do embedding\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"embedding_dimension \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedded_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Cria um tensor de 1 com o tamanho do batch_size e embedding_dimension\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Parameter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ones\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"batch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" embedding_dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# [batch_size, number_of_tokens, embedding_dimension]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                           requires_grad\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# possa ser aprendido\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Mostrar 10 token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Class token shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' -> [batch_size, number_of_tokens, embedding_dimension]\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]], grad_fn=<SliceBackward0>)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Class token shape: torch.Size([1, 1, 768]) -> [batch_size, number_of_tokens, embedding_dimension]\n`})]})}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsxs)(e.p,{children:[\"Aqui est\\xE1 criando com \",(0,n.jsx)(e.code,{children:\"torch.ones\"}),\", mas na realidade utiliza o \",(0,n.jsx)(e.code,{children:\"torch.randn()\"}),`, para gerar dados aleat\\xF3rios,\ne ir melhorando com o tempo.`]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Agora precisa juntar (concatenar) o \",(0,n.jsx)(e.code,{children:\"class_token\"}),\" com os patches de imagens \",(0,n.jsx)(e.code,{children:\"patch_embedded_image\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Adicionar o class_token ao patch_embedded_image\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedded_image_with_class_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"cat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_embedded_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                                      dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# concatenar na dimensao 1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Print the sequence of patch embeddings with the prepended class token embedding\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"patch_embedded_image_with_class_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Sequence of patch embeddings with class token prepended shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_embedded_image_with_class_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' -> [batch_size, number_of_patches, embedding_dimension]\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[[ 1.0000,  1.0000,  1.0000,  ...,  1.0000,  1.0000,  1.0000],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-0.9145,  0.2454, -0.2292,  ...,  0.6768, -0.4515,  0.3496],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-0.7427,  0.1955, -0.3570,  ...,  0.5823, -0.3458,  0.3261],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         ...,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-1.0072,  0.2795, -0.2804,  ...,  0.7624, -0.4584,  0.3581],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-0.9839,  0.1652, -0.1576,  ...,  0.7489, -0.5478,  0.3486],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-0.9260,  0.1383, -0.1157,  ...,  0.5847, -0.4717,  0.3112]]],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`       grad_fn=<CatBackward0>)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Sequence of patch embeddings with class token prepended shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n`})]})}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Token em primeiro\",src:\"/blog/patchs/token.png\"}),`\n`,(0,n.jsx)(e.h2,{id:\"criando-a-incorpora\\xE7\\xE3o-de-posi\\xE7\\xE3o\",children:\"Criando a incorpora\\xE7\\xE3o de posi\\xE7\\xE3o\"}),`\n`,(0,n.jsx)(e.p,{children:\"Agora \\xE9 necess\\xE1rio criar uma incorpora\\xE7\\xE3o de posi\\xE7\\xE3o aos patches, ou seja, criar uma ordem.\"}),`\n`,(0,n.jsx)(l,{children:\"E_{pos}\"}),`\n`,(0,n.jsx)(c,{rounded:!0,width:600,height:400,caption:\"Posi\\xE7\\xE3o\",src:\"/blog/patchs/posicao.png\"}),`\n`,(0,n.jsx)(e.p,{children:\"A sequ\\xEAncia que ser\\xE1 gerada com a posi\\xE7\\xE3o servira como entrada para o MSA.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Calcular o N (numeros de patches)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"number_of_patches \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"height \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Dimensao do embedding\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"embedding_dimension \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedded_image_with_class_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Criarcao do tensor de posicao\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"position_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Parameter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ones\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             number_of_patches\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             embedding_dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                  requires_grad\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# deixar que possa ser aprendido\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Mostrar 10 posicoes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"position_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Position embeddding shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"position_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' -> [batch_size, number_of_patches, embedding_dimension]\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]], grad_fn=<SliceBackward0>)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Position embeddding shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n`})]})}),`\n`,(0,n.jsx)(s,{type:\"attention\",children:(0,n.jsxs)(e.p,{children:[\"\\xC9 normal que todos os valores aumentem em 1, porque o embeddings de posi\\xE7\\xE3o \\xE9 criado com \",(0,n.jsx)(e.code,{children:\"torch.ones()\"}),\".\"]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Adicionar o position_embedding ao patch_embedded_image_with_class_embedding\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_and_position_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedded_image_with_class_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),` position_embedding\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"patch_and_position_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Patch embeddings, class token prepended and positional embeddings added shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_and_position_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' -> [batch_size, number_of_patches, embedding_dimension]\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`tensor([[[ 2.0000,  2.0000,  2.0000,  ...,  2.0000,  2.0000,  2.0000],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [ 0.0855,  1.2454,  0.7708,  ...,  1.6768,  0.5485,  1.3496],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [ 0.2573,  1.1955,  0.6430,  ...,  1.5823,  0.6542,  1.3261],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         ...,\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [-0.0072,  1.2795,  0.7196,  ...,  1.7624,  0.5416,  1.3581],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [ 0.0161,  1.1652,  0.8424,  ...,  1.7489,  0.4522,  1.3486],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`         [ 0.0740,  1.1383,  0.8843,  ...,  1.5847,  0.5283,  1.3112]]],\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`       grad_fn=<AddBackward0>)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Patch embeddings, class token prepended and positional embeddings added shape: torch.Size([1, 197, 768]) -> [batch_size, number_of_patches, embedding_dimension]\n`})]})}),`\n`,(0,n.jsx)(e.h3,{id:\"um-resumo-sobre-tudo\",children:\"Um resumo sobre tudo\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"set_seeds\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 1. Defina o tamanho do patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 2. Imprima a forma do tensor da imagem original e obtenha as dimens\\xF5es da imagem\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Image tensor shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"height\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" width \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 3. Obtenha o tensor de imagem e adicione a dimens\\xE3o do lote\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"x \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"unsqueeze\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Input image with batch dimension shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 4. Crie uma camada de incorpora\\xE7\\xE3o de patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedding_layer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" PatchEmbedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"in_channels\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                       patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"patch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                       embedding_dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"768\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 5. Passe a imagem pela camada de incorpora\\xE7\\xE3o de patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedding_layer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"x\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Patching embedding shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 6. Crie incorpora\\xE7\\xE3o de token de classe\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"batch_size \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"embedding_dimension \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Parameter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ones\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"batch_size\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" embedding_dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                           requires_grad\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Class token embedding shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 7. Anexe a incorpora\\xE7\\xE3o de token de classe \\xE0 incorpora\\xE7\\xE3o de patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_embedding_class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"cat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" patch_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dim\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Patch embedding with class token shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_embedding_class_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 8. Criar incorpora\\xE7\\xE3o de posi\\xE7\\xE3o\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"number_of_patches \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"height \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" width\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\" patch_size\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"**\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"position_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Parameter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"torch\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ones\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" number_of_patches\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" embedding_dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                  requires_grad\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 9. Adicione incorpora\\xE7\\xE3o de posi\\xE7\\xE3o \\xE0 incorpora\\xE7\\xE3o de patch com token de classe\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"patch_and_position_embedding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" patch_embedding_class_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),` position_embedding\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Patch and position embedding shape: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"patch_and_position_embedding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"shape\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})})]})}function y(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(d,a)})):d(a)}var w=y;function t(a,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f(x);})();\n;return Component;"
  },
  "_id": "blog/patchs.mdx",
  "_raw": {
    "sourceFilePath": "blog/patchs.mdx",
    "sourceFileName": "patchs.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/patchs"
  },
  "type": "Post",
  "slug": "patchs",
  "image": "/blog/patchs/image.jpeg",
  "og": "/blog/patchs/image.jpeg"
}